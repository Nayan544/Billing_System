{% extends 'base.html' %}
{% block title %}Invoice Detail{% endblock %}

{% block content %}

<style>
  h2 {
    color: #333;
    margin-bottom: 10px;
  }

  p {
    line-height: 1.5;
    margin: 5px 0;
  }

  .invoice-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    flex-wrap: wrap;
  }

  .invoice-header > div {
    margin-bottom: 10px;
  }

  .table {
    background-color: #fff;
  }

  .table th {
    background-color: #f1f1f1;
    text-align: center;
  }

  .table td {
    text-align: center;
    vertical-align: middle;
  }

  .totals {
    margin-top: 20px;
  }

  .btn {
    margin-right: 5px;
    margin-bottom: 5px;
  }
</style>

<div class="invoice-header">
  <div>
    <h2>Invoice #{{ invoice.id }} - {{ invoice.customer.name }}</h2>
    <p>
      <strong>Email:</strong> {{ invoice.customer.email }}<br>
      <strong>GST No.:</strong> {{ invoice.customer.gstin }}<br>
      <strong>Contact:</strong> {{ invoice.customer.contact }}<br>
      <strong>Address:</strong> {{ invoice.customer.address }}<br>
      <strong>Date:</strong> {{ invoice.date }}
    </p>
  </div>
  <div style="margin-top: 8px;">
    <a href="{% url 'invoice-add-item' invoice.id %}" class="btn btn-success btn-sm">Add Item</a>
    <a href="{% url 'invoice-pdf' invoice.id %}" class="btn btn-info btn-sm" target="_blank">Download PDF</a>
  </div>
</div>

<hr>

<table class="table table-bordered">
  <thead>
    <tr>
      <th>Product</th>
      <th>Price</th>
      <th>Tax %</th>
      <th>Discount %</th>
      <th>Qty</th>
      <th>Total Price</th>
    </tr>
  </thead>
  <tbody>
    {% for item in invoice.items.all %}
    <tr>
      <td>{{ item.product.name }}</td>
      <td>₹{{ item.product.price }}</td>
      <td>{{ item.product.tax_percent }}</td>
      <td>{{ item.product.discount_percent }}</td>
      <td>{{ item.quantity }}</td>
      <td>₹{{ item.total_price }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<div class="totals">
  <h4>Grand Total: ₹{{ invoice.total_amount }}</h4>

  <h4>Payments</h4>
  {% for p in invoice.payments.all %}
    <p>{{ p.date }} — ₹{{ p.amount }} ({{ p.method }})</p>
  {% endfor %}

  <p><strong>Paid:</strong> ₹{{ invoice.amount_paid }}</p>
  <p><strong>Due:</strong> ₹{{ invoice.balance_due }}</p>
</div>

<a href="{% url 'invoice-add-payment' invoice.id %}" class="btn btn-warning btn-sm">Add Payment</a>
<a href="{% url 'invoice-list' %}" class="btn btn-dark btn-sm">◀Back</a>

{% endblock %}
